<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Games - UGS Library</title>
  <style>
    :root {
  /* This defines the variables so the screen isn't white */
  --bg: #0b0b0b;
  --surface: #121212;
  --border: #222;
  --accent: #5865f2;
  --text: #ffffff;
  --radius: 12px;
}

body, html {
  margin: 0; padding: 0;
  min-height: 100vh; width: 100%;
  background: var(--bg);
  color: var(--text);
  font-family: Arial, sans-serif;
}

    /* --- CUSTOM DARK SCROLLBARS --- */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: var(--bg);
    }
    ::-webkit-scrollbar-thumb {
      background: #222;
      border-radius: 10px;
      border: 1px solid var(--border);
    }
    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent);
    }

    /* For Firefox */
    * {
      scrollbar-width: thin;
      scrollbar-color: #222 var(--bg);
    }

    /* Helper for Search Logic */
    .hidden-section { display: none !important; }

    /* Top Bar Layout */
    .app-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #111;
      padding: 0 20px;
      height: 60px;
      box-sizing: border-box;
      border-bottom: 1px solid var(--border);
      position: fixed; /* Forced fixed for compiler compatibility */
top: 0;
left: 0;
right: 0;
z-index: 1001;
    }

    /* Left: Navigation */
    .nav {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    .nav a {
      color: var(--text);
      text-decoration: none;
      font-weight: bold;
      font-size: 14px;
    }
    .nav a.active { color: var(--accent); }

    /* Middle: Recently Played */
    .recent-container {
      flex: 1;
      display: flex;
      justify-content: center;
      margin: 0 20px;
    }
    .recent {
      display: flex;
      gap: 8px;
    }
    .recent-item {
      background: #222;
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 11px;
      border: 1px solid #333;
      color: #aaa;
    }

    /* Right: Search & Profile */
    .right-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .search {
      width: 250px;
    }
    .search input {
      width: 100%;
      padding: 8px 12px;
      border-radius: var(--radius);
      border: 1px solid #333;
      background: #222;
      color: var(--text);
      outline: none;
    }

    .profile-trigger {
      cursor: pointer;
      display: flex;
      align-items: center;
    }
    .pfp-small {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 1px solid var(--accent);
      background-size: cover;
      background-position: center;
      background-color: #000;
    }

    /* Sidebar and Container */
    .sidebar {
      position: fixed;
      left: 0; top: 60px;
      width: 65px;
      height: calc(100vh - 60px);
      background: var(--surface);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 4px; padding: 10px 5px;
      overflow-y: auto; z-index: 1000;
    }
    .sidebar-btn {
      background: transparent; border: 1px solid transparent;
      color: var(--text); padding: 10px 0; font-size: 14px;
      font-weight: bold; border-radius: 6px; cursor: pointer; transition: 0.2s;
    }
    .sidebar-btn:hover:not(.empty) { background: #222; color: var(--accent); border-color: var(--accent); }
    .sidebar-btn.empty { opacity: 0.15; cursor: default; }

    .main-container {
      margin-top: 60px; /* Offset for the fixed app-bar */
      margin-left: 75px; height: calc(100vh - 60px);
      overflow-y: auto; padding: 30px; box-sizing: border-box; scroll-behavior: smooth;
    }
    .letter-section { margin-bottom: 50px; }
    .letter-header {
      font-size: 28px; color: var(--accent); border-bottom: 2px solid var(--border);
      margin-bottom: 20px; padding-bottom: 5px; font-weight: bold;
    }
    .alphabetical-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px;
    }
    .game-card {
      background: #1c1c28; border-radius: var(--radius); overflow: hidden;
      border: 1px solid var(--border); transition: transform .15s ease, border-color .15s;
      display: flex; flex-direction: column;
    }
    .game-card:hover { transform: translateY(-5px); border-color: var(--accent); }
    .game-thumb { height: 110px; background-size: cover; background-position: center; background-color: #2a2a3a; }
    .game-info { padding: 12px; display: flex; flex-direction: column; gap: 10px; }
    .game-title { font-size: .95rem; margin: 0; height: 2.4em; overflow: hidden; color: var(--text); }
    .button {
      width: 100%; padding: 8px; border-radius: 8px; border: none; font-weight: 600;
      background: linear-gradient(135deg, #5865f2, #404eed); color: white; cursor: pointer;
    }
    /* Fix for Update Log Overlay */
    .update-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85); z-index: 2000;
      display: flex; align-items: center; justify-content: center;
      backdrop-filter: blur(5px);
    }
    .update-overlay.hidden { display: none !important; }
    .overlay-content {
      background: var(--surface); padding: 30px; border-radius: var(--radius);
      border: 1px solid var(--border); width: 90%; max-width: 500px;
      position: relative; max-height: 80vh; overflow-y: auto;
    }
    .close-btn {
      position: absolute; top: 15px; right: 20px; background: none;
      border: none; color: white; font-size: 24px; cursor: pointer;
    }
    /* Fixes overlap and aligns footer items */
.site-footer {
  margin-left: 65px; /* Pushes away from sidebar */
  display: flex;
  justify-content: space-between; /* Copyright left, Version right */
  align-items: center;
  padding: 15px 30px;
  border-top: 1px solid var(--border);
  background: var(--bg);
}

/* Forces copyright to stay on the left */
.footer-center {
  margin: 0;
}

/* Fixes version color to blue */
.version-display {
  color: #3aa0ff !important;
  font-weight: bold;
}
  </style>
</head>
<body>

  <div class="app-bar">
    <div class="nav">
      <a href="homepage.html">Home</a>
      <a href="games.html" class="active">Games</a>
      <a href="settings.html">Settings</a>
      <a href="proxy.html">Proxy</a>
    </div>

    <div class="recent-container">
      <div class="recent" id="recentList"></div>
    </div>

    <div class="right-controls">
      <div class="search">
        <input id="searchInput" type="search" placeholder="Search games…">
      </div>
      <div class="profile-trigger" onclick="location.href='profile.html'">
        <div id="userProfilePic" class="pfp-small"></div>
      </div>
    </div>
  </div>

  <div class="sidebar" id="sidebar"></div>

  <div class="main-container" id="mainContainer">
    <div id="sections-container"></div>
  </div>

  <footer class="site-footer">
    <div class="footer-center">
      <p>&copy; 2026. All Rights Reserved. Perpetual Ownership.</p>
    </div>
    <div class="footer-right" onclick="toggleUpdateLog()" style="cursor: pointer;">
      <div class="version-display" id="versionDisplay">v0.0.0</div>
    </div>
  </footer>

  <div id="updateOverlay" class="update-overlay hidden">
    <div class="overlay-content">
      <button class="close-btn" onclick="toggleUpdateLog()">&times;</button>
      <h1 style="color: var(--accent); margin-bottom: 20px;">Update History</h1>
      <div id="fullLogContainer"></div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>

  <script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyAgsZ68VNL-b5AsWnzll2g_C1Yhw7IowlY",
        authDomain: "gameparadiserawdata.firebaseapp.com",
        projectId: "gameparadiserawdata",
        databaseURL: "https://gameparadiserawdata-default-rtdb.firebaseio.com",
        appId: "1:6326540558:web:8115f5520f0737b239df5f"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const rtdb = firebase.database();
    const STORAGE_KEYS = { history: 'fnf_history', recent: 'fnf_recent', status: 'user_status' };
    
    const stashes = {
      "ParadiseStash": {
        repo: "alecishavoc/game.paradisegames2",
        path: "UGS-Files",
        games: [
          'cl10bullets', 'cl10minutestildawn', 'cl12minibattles', 'cl1on1soccer', 'cl1v1lol', 'cl1v1tennis',
          'Dragonxclient', 'marbleracer', 'mariobuilder64', 'mortalkombat4', 
          'polytrackbutnotflagged', 'rocketknight2', 'snowbros', 'vvvvvv', 'wilywars'
        ]
      },
      "TestingStash": {
        repo: "alecishavoc/testingstuff",
        path: "UGS-Files",
        games: [
          { name: "Eagler Hub", file: "EaglerHub-main/EaglerHub-main/index.html" }
        ]
      }
    };

    const updateHistory = [
      { version: [0, 0, 0], text: `<span style="color: #3aa0ff;">Place Holder</span><br>bruh the update log's dont match AND WHY DID MY D KEY BREAK` },
    ];

    function init() {
  // LOGIN CHECK
  auth.onAuthStateChanged(user => {
    if (user) {
      // SECURE: Update RTDB with current page
      rtdb.ref(`/status/${user.uid}`).set('Browsing Library');
      
      // User is logged in: Load App
      localStorage.setItem(STORAGE_KEYS.status, 'online');
          loadUserTheme(user.uid);
          // Get Profile Pic
          db.collection("users").doc(user.uid).get().then(doc => {
            if(doc.exists && doc.data().photoURL) {
              document.getElementById('userProfilePic').style.backgroundImage = `url('${doc.data().photoURL}')`;
            }
          });

          renderRecent();
          applyUpdateLog();
          generateLibrary();
        } else {
          // Not logged in: Redirect
          window.location.href = "login.html";
        }
      });
    }

    function generateLibrary() {
      const chars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
      const container = document.getElementById('sections-container');
      const sidebar = document.getElementById('sidebar');
      
      const allGames = [];
      for (const [stashName, data] of Object.entries(stashes)) {
        data.games.forEach(gameEntry => {
          let fileName, displayName;
          if (typeof gameEntry === 'object') {
            fileName = gameEntry.file;
            displayName = gameEntry.name;
          } else {
            fileName = gameEntry;
            displayName = gameEntry.startsWith('cl') ? gameEntry.substring(2) : gameEntry;
          }
          allGames.push({ fileName, displayName, stash: stashName });
        });
      }

      allGames.sort((a, b) => a.displayName.localeCompare(b.displayName));
      const groups = {};
      chars.forEach(c => groups[c] = []);
      allGames.forEach(game => {
        let firstChar = game.displayName[0].toUpperCase();
        if (!chars.includes(firstChar)) firstChar = "0";
        if (groups[firstChar]) groups[firstChar].push(game);
      });

      chars.forEach(char => {
        const sBtn = document.createElement('button');
        sBtn.className = `sidebar-btn ${groups[char].length === 0 ? 'empty' : ''}`;
        sBtn.textContent = char;
        if (groups[char].length > 0) {
          sBtn.onclick = () => document.getElementById(`section-${char}`).scrollIntoView();
          const sec = document.createElement('section');
          sec.id = `section-${char}`;
          sec.className = 'letter-section';
          sec.innerHTML = `<div class="letter-header">${char}</div>`;
          const grid = document.createElement('div');
          grid.className = 'alphabetical-grid';
          groups[char].forEach(game => {
            const card = document.createElement('div');
            card.className = 'game-card';
            card.innerHTML = `
              <div class="game-thumb"></div>
              <div class="game-info">
                <h3 class="game-title">${game.displayName}</h3>
                <button class="button" onclick="launchGame('${game.fileName}', '${game.displayName}', '${game.stash}')">Play</button>
              </div>`;
            grid.appendChild(card);
          });
          sec.appendChild(grid);
          container.appendChild(sec);
        }
        sidebar.appendChild(sBtn);
      });
    }

    async function launchGame(fileName, displayName, stashName) {
  // SECURE: Update Live Activity (RTDB - Overwrites old activity to save space)
  if (auth.currentUser) {
      rtdb.ref(`/status/${auth.currentUser.uid}`).set('Playing: ' + displayName);
      
      // ARCHIVE: Save to Firestore history (Moves processing off RTDB)
      db.collection("users").doc(auth.currentUser.uid).collection("history").add({
    title: displayName, 
    playedAt: firebase.firestore.FieldValue.serverTimestamp(),
    icon: "" 
}).then(() => {
    console.log("SENT TO FIREBASE SUCCESSFULLY");
}).catch((error) => {
    console.error("FIREBASE REJECTED THE DATA: ", error);
});
  }

  localStorage.setItem(STORAGE_KEYS.status, 'playing: ' + displayName);

      const stash = stashes[stashName];
      const normalized = fileName.includes('.') ? fileName : fileName + '.html';
      const fullUrl = `https://cdn.jsdelivr.net/gh/${stash.repo}/${stash.path}/${normalized}`;
      const folderPath = fullUrl.substring(0, fullUrl.lastIndexOf('/') + 1);
      
      const now = Date.now();
      const recent = JSON.parse(localStorage.getItem(STORAGE_KEYS.recent) || '[]');

      const filteredRecent = recent.filter(r => r.name !== displayName);
      filteredRecent.unshift({ name: displayName, link: fullUrl, time: now });
      localStorage.setItem(STORAGE_KEYS.recent, JSON.stringify(filteredRecent.slice(0, 5)));

      renderRecent();

      try {
        const response = await fetch(fullUrl + '?t=' + Date.now());
        const rawText = await response.text();
        const newWin = window.open('about:blank', '_blank');
        if (newWin) {
          newWin.document.open();
          const baseTag = `<base href="${folderPath}">`;
          const fixedText = rawText.includes('<head>') 
            ? rawText.replace('<head>', `<head>${baseTag}`)
            : baseTag + rawText;
          newWin.document.write(fixedText);
          newWin.document.close();
        }
      } catch (err) {
        window.open(fullUrl, '_blank');
      }
    }

    function renderRecent() {
      const list = document.getElementById('recentList');
      if (!list) return;
      list.innerHTML = '';
      const recent = JSON.parse(localStorage.getItem(STORAGE_KEYS.recent) || '[]');
      recent.forEach(item => {
        const div = document.createElement('div');
        div.className = 'recent-item';
        div.textContent = item.name;
        list.appendChild(div);
      });
    }

    function applyUpdateLog() {
      const latest = updateHistory[updateHistory.length - 1];
      const vDisplay = document.getElementById('versionDisplay');
      // Fix version display string
      if(vDisplay) vDisplay.textContent = 'v' + latest.version.join('.');
      
      const logContainer = document.getElementById('fullLogContainer');
      if(logContainer) {
          logContainer.innerHTML = updateHistory.slice().reverse().map(u => `
            <div style="margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; text-align: left;">
              <h2 style="color: var(--accent); margin: 0; font-size: 1.2rem;">v${u.version.join('.')}</h2>
              <div style="font-size: 14px; color: #ccc; margin-top: 5px;">${u.text}</div>
            </div>`).join('');
      }
    }

    function toggleUpdateLog() { 
      const log = document.getElementById('updateOverlay');
      if (log) log.classList.toggle('hidden');
    }
    // --- PASTE START ---
    function loadUserTheme(uid) {
        db.collection("users").doc(uid).collection("settings").doc("appearance").get().then(doc => {
            if (doc.exists) {
                const data = doc.data();
                const root = document.documentElement;

                switch(data.themePreset) {
                    case 'red': root.style.setProperty('--bg', '#1a0505'); root.style.setProperty('--surface', '#250a0a'); root.style.setProperty('--border', '#451515'); break;
                    case 'blue': root.style.setProperty('--bg', '#050a1a'); root.style.setProperty('--surface', '#0a1425'); root.style.setProperty('--border', '#152545'); break;
                    case 'green': root.style.setProperty('--bg', '#051a05'); root.style.setProperty('--surface', '#0a250a'); root.style.setProperty('--border', '#154515'); break;
                    case 'yellow': root.style.setProperty('--bg', '#1a1a05'); root.style.setProperty('--surface', '#25250a'); root.style.setProperty('--border', '#454515'); break;
                    case 'orange': root.style.setProperty('--bg', '#1a1005'); root.style.setProperty('--surface', '#25150a'); root.style.setProperty('--border', '#452515'); break;
                    case 'purple': root.style.setProperty('--bg', '#10051a'); root.style.setProperty('--surface', '#150a25'); root.style.setProperty('--border', '#251545'); break;
                    case 'pink': root.style.setProperty('--bg', '#1a0510'); root.style.setProperty('--surface', '#250a15'); root.style.setProperty('--border', '#451525'); break;
                    case 'black': root.style.setProperty('--bg', '#000000'); root.style.setProperty('--surface', '#080808'); root.style.setProperty('--border', '#111'); break;
                    case 'white': root.style.setProperty('--bg', '#f0f0f0'); root.style.setProperty('--surface', '#ffffff'); root.style.setProperty('--border', '#ccc'); break;
                    case 'gray': root.style.setProperty('--bg', '#1a1a1a'); root.style.setProperty('--surface', '#222222'); root.style.setProperty('--border', '#333'); break;
                    case 'cyberpunk': root.style.setProperty('--bg', '#000000'); root.style.setProperty('--surface', '#0a0a1a'); root.style.setProperty('--border', '#ff0055'); break;
                    case 'nordic': root.style.setProperty('--bg', '#2e3440'); root.style.setProperty('--surface', '#3b4252'); root.style.setProperty('--border', '#4c566a'); break;
                    case 'amethyst': root.style.setProperty('--bg', '#0f051a'); root.style.setProperty('--surface', '#180a25'); root.style.setProperty('--border', '#351545'); break;
                    case 'midnight': root.style.setProperty('--bg', '#020205'); root.style.setProperty('--surface', '#050510'); root.style.setProperty('--border', '#101030'); break;
                    case 'matrix': root.style.setProperty('--bg', '#000500'); root.style.setProperty('--surface', '#001000'); root.style.setProperty('--border', '#00ff41'); break;
                    case 'oceanic': root.style.setProperty('--bg', '#010b13'); root.style.setProperty('--surface', '#021627'); root.style.setProperty('--border', '#032b4d'); break;
                    case 'lava': root.style.setProperty('--bg', '#100000'); root.style.setProperty('--surface', '#200000'); root.style.setProperty('--border', '#ff4500'); break;
                    case 'vaporwave': root.style.setProperty('--bg', '#1a0033'); root.style.setProperty('--surface', '#2d0059'); root.style.setProperty('--border', '#ff71ce'); break;
                    case 'forest': root.style.setProperty('--bg', '#0a1005'); root.style.setProperty('--surface', '#15200a'); root.style.setProperty('--border', '#2d4d1a'); break;
                    case 'space': root.style.setProperty('--bg', '#05000a'); root.style.setProperty('--surface', '#0b001a'); root.style.setProperty('--border', '#4b0082'); break;
                    default:
                        root.style.setProperty('--bg', '#0b0b0b');
                        root.style.setProperty('--surface', '#121212');
                        root.style.setProperty('--border', '#222');
                }

                if (data.accentColor) root.style.setProperty('--accent', data.accentColor);
                if (data.textColor) root.style.setProperty('--text', data.textColor);
                
                if (data.borderGlow) {
                    root.style.setProperty('--glow', `0 0 15px ${data.accentColor || 'var(--accent)'}`);
                }
            }
        });
    }
    // --- PASTE END ---

    document.getElementById('searchInput').addEventListener('input', (e) => {
      const term = e.target.value.toLowerCase();
      
      // Select every letter group section
      document.querySelectorAll('.letter-section').forEach(section => {
        let hasVisibleGame = false;
        
        // Filter the cards inside this section
        const cards = section.querySelectorAll('.game-card');
        cards.forEach(card => {
          const title = card.querySelector('.game-title').textContent.toLowerCase();
          if (title.includes(term)) {
            card.style.display = 'flex';
            hasVisibleGame = true; // Mark that this section has a match
          } else {
            card.style.display = 'none';
          }
        });

        // Hide the whole section (Header + Grid) if no matches found
        if (hasVisibleGame) {
          section.classList.remove('hidden-section');
        } else {
          section.classList.add('hidden-section');
        }
      });
    });

    init();
    // --- Activity Tracker ---
let lastActivity = Date.now();
function updateStatus(status) {
    if (!auth.currentUser) return;
    rtdb.ref(`/status/${auth.currentUser.uid}`).onDisconnect().set('offline');
    rtdb.ref(`/status/${auth.currentUser.uid}`).set(status);
}

// Track page movement
['mousedown', 'keydown', 'mousemove', 'touchstart'].forEach(evt => {
    window.addEventListener(evt, () => {
        if (Date.now() - lastActivity > 5000) { // Throttled to 5s
            lastActivity = Date.now();
            updateStatus('active');
        }
    });
});

// Idle Check
setInterval(() => {
    if (Date.now() - lastActivity > 3 * 60 * 1000) updateStatus('idle');
}, 30000);
// Add this to tell the database you are on the "Library" page
auth.onAuthStateChanged(user => {
    if (user) {
        rtdb.ref(`/status/${user.uid}`).set('Browsing Library');
    }
});
  </script>
</body>
</html>